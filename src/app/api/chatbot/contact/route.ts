import { NextResponse } from 'next/server';
import { prisma } from '@/lib/db';

// 100 prompts v·ªÅ Contact Information
const CONTACT_RESPONSES = [
  // Email communication
  "üìß Email l√† c√°ch t·ªët nh·∫•t ƒë·ªÉ th·∫£o lu·∫≠n v·ªÅ c∆° h·ªôi ngh·ªÅ nghi·ªáp v√† technical discussions chi ti·∫øt.",
  "Th∆∞·ªùng ph·∫£n h·ªìi emails trong v√≤ng 24 gi·ªù, s·∫µn s√†ng schedule calls ho·∫∑c meetings.",
  "Email ph√π h·ª£p cho: job opportunities, project discussions, technical consultations.",
  "Professional email communication v·ªõi detailed responses v·ªÅ requirements v√† proposals.",
  "Prefer email cho formal discussions, documentation, v√† follow-up communications.",
  
  // Phone communication
  "üìû Phone calls available cho urgent discussions ho·∫∑c real-time problem solving.",
  "Best time ƒë·ªÉ call: business hours (9 AM - 6 PM) ho·∫∑c schedule tr∆∞·ªõc.",
  "Phone consultations cho: technical issues, project planning, quick clarifications.",
  "Voice calls preferred cho complex discussions requiring immediate feedback.",
  "International calling available cho remote collaborations v√† global clients.",
  
  // Social media presence
  "üåê LinkedIn cho professional networking, industry updates, career opportunities.",
  "GitHub showcases code quality, project contributions, open source involvement.",
  "Twitter cho tech discussions, industry trends, quick updates.",
  "Professional social media presence v·ªõi regular updates v·ªÅ projects v√† achievements.",
  "Social platforms offer different communication styles cho various purposes.",
  
  // Response time commitments
  "‚ö° Email responses within 24 hours for all professional inquiries.",
  "Phone availability during business hours v·ªõi scheduled calls preferred.",
  "Social media monitoring v·ªõi responses trong reasonable timeframes.",
  "Emergency contact available cho urgent project issues ho·∫∑c critical bugs.",
  "Weekend availability cho urgent client needs ho·∫∑c production issues.",
  
  // Preferred communication methods
  "Email best cho: detailed discussions, documentation, formal proposals.",
  "Phone ideal cho: brainstorming sessions, complex explanations, immediate feedback.",
  "Video calls excellent cho: demos, screen sharing, collaborative planning.",
  "Chat platforms useful cho: quick questions, status updates, informal discussions.",
  "In-person meetings available cho local clients, major project kickoffs.",
  
  // Professional networking
  "LinkedIn connections welcome t·ª´ industry professionals, potential collaborators.",
  "GitHub followers appreciated, code reviews v√† contributions encouraged.",
  "Professional community participation through meetups, conferences, workshops.",
  "Industry networking for knowledge sharing, collaboration opportunities.",
  "Mentor relationships v·ªõi junior developers, career guidance discussions.",
  
  // Project inquiry process
  "Initial contact: brief project description, timeline, budget considerations.",
  "Follow-up meeting: detailed requirements, technical specifications, deliverables.",
  "Proposal phase: timeline, milestones, pricing, terms of engagement.",
  "Contract discussion: legal terms, payment schedule, revision processes.",
  "Project kickoff: communication protocols, progress reporting, feedback cycles.",
  
  // Collaboration preferences
  "Remote collaboration preferred v·ªõi flexible timezone accommodations.",
  "Regular check-ins through video calls, progress reports, milestone reviews.",
  "Collaborative tools: Slack, Discord, Microsoft Teams cho team communication.",
  "Project management: Trello, Asana, Jira cho task tracking, progress monitoring.",
  "Code collaboration: GitHub, GitLab v·ªõi pull request workflows.",
  
  // Meeting scheduling
  "Calendar availability shared cho easy meeting scheduling.",
  "Time zone flexibility cho international clients, distributed teams.",
  "Meeting agenda preparation cho productive discussions, clear outcomes.",
  "Recording availability cho reference, team members unable to attend.",
  "Follow-up documentation v·ªõi action items, decisions, next steps.",
  
  // Technical support
  "Post-launch support available cho bug fixes, feature enhancements.",
  "Emergency technical support cho critical production issues.",
  "Training sessions available cho team onboarding, knowledge transfer.",
  "Documentation provided cho system maintenance, future development.",
  "Long-term relationship building v·ªõi ongoing support v√† improvements.",
  
  // Consultation services
  "Technical consultations cho architecture decisions, technology selection.",
  "Code reviews available cho quality assurance, best practices guidance.",
  "Performance audits cho existing systems, optimization recommendations.",
  "Security assessments v·ªõi vulnerability identification, remediation plans.",
  "Training workshops cho team skill development, technology adoption.",
  
  // Communication etiquette
  "Professional communication standards v·ªõi clear, concise messaging.",
  "Respectful response times acknowledging receipt, setting expectations.",
  "Constructive feedback delivery v·ªõi positive, solution-oriented approach.",
  "Cultural sensitivity trong international communications, diverse teams.",
  "Confidentiality respect cho client information, proprietary details.",
  
  // Contact form usage
  "üìù Contact form provides structured way to submit detailed inquiries.",
  "Form submissions reviewed daily v·ªõi personalized responses.",
  "Preferred cho: initial project inquiries, service requests, general questions.",
  "Automatic confirmation sent v·ªõi response timeline expectations.",
  "Follow-up communications moved to email cho detailed discussions.",
  
  // Location v√† availability
  "üìç Remote work available globally v·ªõi timezone considerations.",
  "Local meetings possible trong specific geographic areas.",
  "Travel available cho major projects, on-site consultations.",
  "Flexible scheduling accommodating different time zones, work schedules.",
  "Holiday schedule communicated in advance v·ªõi coverage arrangements.",
  
  // Language preferences
  "üó£Ô∏è English v√† Vietnamese communication available cho diverse clients.",
  "Technical documentation provided trong preferred language.",
  "Translation services available cho international collaborations.",
  "Cultural adaptation trong communication styles, business practices.",
  "Multilingual support enhancing global client relationships.",
  
  // Emergency contact
  "üö® Emergency contact available cho production issues, critical bugs.",
  "Escalation procedures defined cho different severity levels.",
  "Response time commitments cho various emergency categories.",
  "Backup contact information provided cho team continuity.",
  "Emergency procedures documented cho client reference.",
  
  // Privacy v√† security
  "üîí Secure communication channels cho sensitive information.",
  "Confidentiality agreements respected, NDA compliance maintained.",
  "Data protection protocols followed cho client information.",
  "Secure file sharing platforms cho document exchange.",
  "Privacy preferences respected trong communication choices.",
  
  // Feedback v√† testimonials
  "‚≠ê Client feedback encouraged cho service improvement.",
  "Testimonials available t·ª´ previous clients, collaborators.",
  "Reference contacts provided cho verification purposes.",
  "Case studies available demonstrating successful collaborations.",
  "Portfolio evidence supporting communication effectiveness.",
  
  // Follow-up processes
  "üìã Systematic follow-up ensuring no communications missed.",
  "Progress updates provided at regular intervals.",
  "Milestone celebrations with client acknowledgment.",
  "Project completion follow-up v·ªõi satisfaction assessment.",
  "Long-term relationship maintenance v·ªõi periodic check-ins.",
  
  // Communication tools
  "üí¨ Modern communication tools utilized cho efficient interactions.",
  "Video conferencing: Zoom, Google Meet, Microsoft Teams.",
  "Instant messaging: Slack, Discord, WhatsApp cho quick updates.",
  "Project collaboration: Notion, Confluence cho documentation.",
  "Screen sharing capabilities cho demonstrations, troubleshooting.",
  
  // Professional boundaries
  "‚è∞ Business hours respected v·ªõi clear availability windows.",
  "Response time expectations set v√† consistently met.",
  "Professional tone maintained across all communication channels.",
  "Scope boundaries established cho project discussions.",
  "Payment terms discussed upfront avoiding future complications.",
  
  // International clients
  "üåç International client experience v·ªõi global business practices.",
  "Currency considerations cho international invoicing.",
  "Legal compliance v·ªõi international regulations, standards.",
  "Cultural awareness enhancing cross-border collaborations.",
  "Time zone coordination cho real-time collaboration needs.",
  
  // Client onboarding
  "üéØ Structured onboarding process cho new client relationships.",
  "Initial discovery sessions understanding business needs.",
  "Expectation setting cho deliverables, timelines, communication.",
  "Tool setup assistance cho collaboration platforms.",
  "Relationship establishment with key stakeholders.",
  
  // Contact verification
  "‚úÖ Contact information regularly updated ensuring accuracy.",
  "Multiple contact methods provided cho redundancy.",
  "Contact preference accommodation cho client comfort.",
  "Verification processes preventing miscommunications.",
  "Regular contact information audits maintaining current details.",
  
  // Referral network
  "ü§ù Professional referral network cho specialized services.",
  "Partner recommendations cho complementary skills.",
  "Subcontractor network cho larger project requirements.",
  "Industry connections cho business development opportunities.",
  "Collaboration opportunities v·ªõi other professionals.",
  
  // Digital presence
  "üíª Professional website maintained v·ªõi current contact information.",
  "Portfolio constantly updated v·ªõi recent work examples.",
  "Blog maintained cho industry insights, technical tutorials.",
  "Professional profiles consistent across platforms.",
  "Digital footprint managed cho professional credibility.",
  
  // Contact analytics
  "üìä Response time tracking ensuring quality service.",
  "Communication effectiveness measured through client feedback.",
  "Contact method preferences analyzed cho service optimization.",
  "Client satisfaction metrics tracked improving service delivery.",
  "Communication patterns analyzed enhancing client experience.",
  
  // Alternative contact methods
  "üì± Messaging apps available cho informal communications.",
  "Social media DMs monitored cho quick questions.",
  "Professional forums participation cho community discussions.",
  "Industry events attendance providing networking opportunities.",
  "Online presence maintained across relevant platforms.",
  
  // Contact security
  "üõ°Ô∏è Secure contact methods preferred cho sensitive communications.",
  "Encrypted email available cho confidential discussions.",
  "Secure meeting platforms cho privacy-critical conversations.",
  "Contact information protection t·ª´ unauthorized access.",
  "Professional communication security protocols followed.",
  
  // Client relationship management
  "üìà CRM system utilized cho systematic client relationship management.",
  "Contact history maintained cho continuity across interactions.",
  "Preference tracking ensuring personalized communication approaches.",
  "Relationship milestones celebrated with clients.",
  "Long-term value focus rather than transactional relationships.",
  
  // Communication innovation
  "üöÄ Latest communication technologies explored cho enhanced client experience.",
  "AI-assisted communication tools evaluated cho efficiency improvements.",
  "Automation balanced v·ªõi personal touch trong client interactions.",
  "Innovation adoption balanced v·ªõi reliability v√† familiarity.",
  "Future communication trends considered cho service enhancement."
];

export async function GET(request: Request) {
  try {
    const { searchParams } = new URL(request.url);
    const query = searchParams.get('query')?.toLowerCase() || '';
    
    // L·∫•y th√¥ng tin contact t·ª´ database
    const contactInfo = await prisma.contactInfo.findFirst();

    // Filter responses d·ª±a tr√™n query
    let relevantResponses = CONTACT_RESPONSES;
    
    if (query.includes('email') || query.includes('mail')) {
      relevantResponses = CONTACT_RESPONSES.filter((_, index) => 
        index >= 0 && index <= 9 // Email communication section
      );
    } else if (query.includes('phone') || query.includes('ƒëi·ªán tho·∫°i')) {
      relevantResponses = CONTACT_RESPONSES.filter((_, index) => 
        index >= 5 && index <= 14 // Phone communication section
      );
    } else if (query.includes('social') || query.includes('linkedin') || query.includes('github')) {
      relevantResponses = CONTACT_RESPONSES.filter((_, index) => 
        index >= 10 && index <= 19 // Social media section
      );
    } else if (query.includes('form') || query.includes('contact form')) {
      relevantResponses = CONTACT_RESPONSES.filter((_, index) => 
        index >= 60 && index <= 69 // Contact form section
      );
    }

    // Ch·ªçn random response
    const randomResponse = relevantResponses[Math.floor(Math.random() * relevantResponses.length)];

    // Th√™m th√¥ng tin contact th·ª±c t·∫ø
    let response = randomResponse;
    if (contactInfo) {
      const contactDetails = [];
      if (contactInfo.email) contactDetails.push(`üìß Email: ${contactInfo.email}`);
      if (contactInfo.phone) contactDetails.push(`üìû Phone: ${contactInfo.phone}`);
      if (contactInfo.address) contactDetails.push(`üìç Address: ${contactInfo.address}`);
      
      const socialLinks = [];
      if (contactInfo.githubUrl) socialLinks.push(`GitHub: ${contactInfo.githubUrl}`);
      if (contactInfo.linkedinUrl) socialLinks.push(`LinkedIn: ${contactInfo.linkedinUrl}`);
      if (contactInfo.twitterUrl) socialLinks.push(`Twitter: ${contactInfo.twitterUrl}`);
      
      if (contactDetails.length > 0) {
        response += `\n\n**Contact Information:**\n${contactDetails.join('\n')}`;
      }
      
      if (socialLinks.length > 0) {
        response += `\n\n**Social Links:**\n${socialLinks.join('\n')}`;
      }
    }

    return NextResponse.json({ 
      response,
      intent: 'contact',
      source: 'contact_service',
      hasContactInfo: !!contactInfo
    });

  } catch (error) {
    console.error('Contact API error:', error);
    return NextResponse.json(
      { error: 'Failed to get contact information' },
      { status: 500 }
    );
  }
}
